# 3.0 传输层

## 章节概览

> **连接应用与网络的桥梁**
> 
> 传输层位于应用层和网络层之间，负责为运行在不同主机上的应用进程提供端到端的逻辑通信服务。

## 章节目录

- **[3.1 传输层：服务模型与多路复用](3.1传输层：服务模型与多路复用.md)**
  - 传输层的基本服务
  - 多路复用与多路分解机制
  - 端口号和套接字概念

- **[3.2 传输层：UDP协议与应用](3.2传输层：UDP协议与应用.md)**
  - UDP协议结构和特性
  - UDP的优势与局限性
  - UDP编程实例和应用场景

- **[3.3 传输层：可靠传输原理](3.3传输层：可靠传输原理.md)**
  - 可靠数据传输问题分析
  - 停等协议和滑动窗口
  - 错误检测和纠正机制

- **[3.4 传输层：TCP协议基础](3.4传输层：TCP协议基础.md)**
  - TCP段结构与首部字段
  - TCP连接建立与终止
  - TCP状态机分析

- **[3.5 传输层：TCP流量控制](3.5传输层：TCP流量控制.md)**
  - 接收窗口机制
  - 流量控制算法
  - Nagle算法和延迟确认

- **[3.6 传输层：TCP拥塞控制](3.6传输层：TCP拥塞控制.md)**
  - 拥塞控制基本原理
  - 慢启动和拥塞避免算法
  - 快速重传和快速恢复

- **[3.7 传输层：现代传输技术](3.7传输层：现代传输技术.md)**
  - QUIC协议详解
  - 多路径TCP (MPTCP)
  - TCP优化技术和未来发展
 
## 传输层性能分析与计算

### 基本性能参数

**传输层的关键性能指标**：

| 参数名称 | 定义 | 计算公式 | 影响因素 |
|----------|------|----------|----------|
| **吞吐量** | 单位时间内传输的数据量 | $\text{吞吐量} = \frac{\text{数据量}}{\text{时间}}$ | 窗口大小、网络延迟 |
| **延迟** | 数据从发送到接收的时间 | $\text{延迟} = \text{传播延迟} + \text{排队延迟} + \text{处理延迟}$ | 距离、拥塞程度 |
| **利用率** | 信道的使用效率 | $\text{利用率} = \frac{\text{有效传输时间}}{\text{总时间}}$ | 协议开销、重传次数 |

### 408考研典型计算

#### 计算类型1：滑动窗口效率

**例题**：在带宽为1Mbps、往返时间为20ms的链路上，使用TCP传输。如果滑动窗口大小为64KB，计算链路利用率。

**解析**：
1. **带宽延迟积**：$\text{BDP} = 1\text{Mbps} \times 20\text{ms} = 20000\text{bit} = 2500\text{字节}$
2. **窗口大小**：$64\text{KB} = 65536\text{字节}$  
3. **利用率**：$\min(1, \frac{65536}{2500}) = 1$ (100%)

**结论**：窗口大小充足，可以充分利用链路

#### 计算类型2：传输时间分析

**例题**：发送64KB数据，链路带宽10Mbps，往返时间40ms，TCP段大小1KB。计算使用停等协议的总传输时间。

**解析**：
1. **段数量**：$\frac{64\text{KB}}{1\text{KB}} = 64\text{个段}$
2. **每段传输时间**：$\frac{1\text{KB} \times 8}{10\text{Mbps}} = 0.8\text{ms}$
3. **每个往返周期**：$0.8\text{ms} + 40\text{ms} = 40.8\text{ms}$
4. **总时间**：$64 \times 40.8\text{ms} = 2.61\text{s}$

#### 计算类型3：拥塞控制算法分析

**例题**：TCP使用慢启动算法，初始窗口1MSS，阈值16MSS。网络在第10个往返时发生拥塞。请画出拥塞窗口变化图。

**解析过程**：
```
RTT 1: cwnd=1    (慢启动)
RTT 2: cwnd=2    (慢启动)  
RTT 3: cwnd=4    (慢启动)
RTT 4: cwnd=8    (慢启动)
RTT 5: cwnd=16   (达到阈值，转为拥塞避免)
RTT 6: cwnd=17   (拥塞避免)
RTT 7: cwnd=18   (拥塞避免)
...
RTT 10: 拥塞发生，阈值=cwnd/2=10，cwnd=1
```

### 协议性能对比

**不同传输协议的效率对比**：

| 协议类型 | 最大利用率 | 适用场景 | 主要限制 |
|----------|------------|----------|----------|
| **停等协议** | $\frac{1}{1 + 2a}$ | 低延迟网络 | 往返时间影响大 |
| **回退N帧** | $\frac{N}{1 + 2a}$（无错时） | 中等延迟网络 | 错误时性能下降严重 |
| **选择重传** | $\frac{N}{1 + 2a}$（近似） | 高延迟/高错误率网络 | 复杂度较高 |

**注**：$a = \frac{\text{传播延迟}}{\text{发送延迟}}$

### 实际网络性能估算

**快速估算方法**：

1. **确定瓶颈**：$\text{最大吞吐量} = \min(\text{发送速率}, \frac{\text{窗口大小}}{\text{RTT}})$

2. **考虑重传影响**：$\text{实际吞吐量} = \text{理论吞吐量} \times (1 - \text{丢包率})$

3. **协议开销**：$\text{有效吞吐量} = \text{实际吞吐量} \times \frac{\text{数据大小}}{\text{数据大小} + \text{头部大小}}$

**典型网络环境参考值**：
- **局域网**：RTT 1-5ms，丢包率 < 0.01%
- **广域网**：RTT 50-200ms，丢包率 0.1-1%
- **卫星链路**：RTT 500-600ms，丢包率 0.1-0.5%

---

**开始学习：[3.1 传输层服务模型](3.1传输层：服务模型与多路复用.md)**
