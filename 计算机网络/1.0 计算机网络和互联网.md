# 1.0 计算机网络和互联网

## 目录

1. [学习目标](#学习目标)
2. [重要性概览](#重要性概览)
3. [什么是互联网](#什么是互联网)
4. [网络边缘](#网络边缘)
5. [网络核心](#网络核心)
6. [协议分层和服务模型](#协议分层和服务模型)
7. [网络性能指标](#网络性能指标)
8. [网络安全概述](#网络安全概述)
9. [典型例题](#典型例题)
10. [本章小结](#本章小结)

---
 
## 什么是互联网

### 互联网的组成描述

互联网可以从两个角度来描述：**具体构成描述**和**服务描述**。

#### 具体构成描述

从具体构成角度看，互联网是一个全球性的计算机网络，它连接了数十亿计算设备。

> **互联网的基本组成**
> 
> - **主机(Host)**：位于网络边缘的计算设备，也称为**端系统(End System)**
> - **通信链路(Communication Link)**：连接设备的物理媒体
> - **分组交换机(Packet Switch)**：转发数据包的中间设备，包括路由器和交换机
> - **互联网服务提供商(ISP)**：提供互联网接入服务的组织

**主机类型**：
- 传统计算机：台式机、笔记本电脑、服务器
- 移动设备：智能手机、平板电脑
- 非传统设备：智能电视、游戏机、物联网设备

#### 服务描述

从服务角度看，互联网是为分布式应用程序提供服务的基础设施。

> **互联网提供的服务**
> 
> - **通信基础设施**：为分布式应用程序提供通信服务
> - **编程接口**：应用程序通过套接字接口使用网络服务
> - **服务承诺**：提供数据传输的各种服务保证

### 网络协议

> **协议(Protocol)定义**
> 
> 协议定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其他事件所采取的动作。

**协议的三要素**：
1. **语法(Syntax)**：数据与控制信息的结构或格式
2. **语义(Semantics)**：需要发出何种控制信息，完成何种动作以及做出何种响应
3. **时序(Timing)**：事件实现顺序的详细说明

### 互联网标准

> **RFC(Request for Comments)**
> 
> RFC是定义互联网协议和标准的文档系列，由Internet Engineering Task Force (IETF)发布和维护。

**RFC文档类型**：
1. **Internet标准**：经过充分测试和广泛实施的协议
2. **提议标准**：稳定的规范，等待进一步测试
3. **实验性RFC**：用于实验目的的协议
4. **信息性RFC**：提供信息但不定义标准
5. **历史性RFC**：已过时或被替代的标准

**重要的RFC文档示例**：
- RFC 791：Internet Protocol (IPv4)
- RFC 793：Transmission Control Protocol (TCP)
- RFC 2460：Internet Protocol Version 6 (IPv6)
- RFC 7231：HTTP/1.1语义和内容
- RFC 1035：DNS实现和规范

**人类对话中的协议类似**：
```
人A：你好！
人B：你好！
人A：现在几点了？
人B：现在是下午3点。
```

**网络协议类似**：
```
客户端：GET /index.html HTTP/1.1
服务器：HTTP/1.1 200 OK
服务器：(传输index.html文件)
```

---

## 网络边缘

### 端系统和接入网

**端系统**运行网络应用程序，这些应用程序包括：
- Web浏览器（Chrome、Firefox）
- 电子邮件客户端（Outlook、Gmail）
- 文件传输程序（FTP客户端）
- 即时通信软件（微信、QQ）

#### 接入网

**接入网(Access Network)**：将端系统连接到其边缘路由器的网络。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。

**住宅接入网**：

1. **数字用户线路(DSL)**
   - 利用现有的电话线
   - 下行速率：24 Mbps，上行速率：2.5 Mbps
   - 频分复用：电话和数据同时传输

2. **电缆互联网接入**
   - 利用有线电视网络
   - 下行速率：42.8 Mbps，上行速率：30.7 Mbps
   - 共享接入：同一区域用户共享带宽

3. **光纤到户(FTTH)**
   - 直接光纤连接到用户住宅
   - 速率可达Gbps级别
   - 两种架构：主动光纤网络(AON)和被动光纤网络(PON)

**企业接入网**：

1. **以太网**
   - 速率：10 Mbps 到 100 Gbps
   - 交换式以太网：每个用户拥有专用的从交换机到端系统的以太网链路

2. **WiFi**
   - 无线局域网技术
   - 速率：11 Mbps 到 6.93 Gbps（802.11ax）

**广域无线接入**：

1. **4G LTE**
   - 速率：数十Mbps
   - 覆盖半径：数十公里

2. **5G**
   - 速率：数百Mbps到Gbps
   - 低延迟：1ms以下

### 物理媒体

**物理媒体分类**：

**导引型媒体**：
- **双绞线**：最便宜、最常用的传输媒体
- **同轴电缆**：两个同心铜导体，能达到很高的传输速率
- **光缆**：传输距离长、速率高、抗干扰能力强

**非导引型媒体**：
- **陆地无线电信道**：WiFi、蜂窝网络
- **卫星无线电信道**：地球同步卫星、低地球轨道卫星

---

## 网络核心

网络核心是由互联因特网端系统的分组交换机和链路构成的网状网络。

### ISP的层次结构

现实的网络结构比简单的全连通更复杂。互联网实际上是一个**网络的网络**。

> **互联网服务提供商(ISP)层次结构**
> 
> - **第1层ISP(Tier-1 ISP)**：国际性ISP，相互对等连接
> - **第2层ISP(Tier-2 ISP)**：区域性ISP，向第1层ISP付费
> - **第3层ISP(Tier-3 ISP)**：接入ISP，向第2层ISP付费

**ISP连接关系**：

1. **对等连接(Peering)**
   - 相同层级的ISP之间的免费连接
   - 第1层ISP之间通常采用对等连接
   - 目的：降低成本，提高性能

2. **传输连接(Transit)**
   - 下层ISP向上层ISP付费购买连接服务
   - 上层ISP为下层ISP提供到互联网其他部分的连接

3. **存在点(PoP)**
   - 客户ISP与提供商ISP连接的位置
   - 包含一台或多台路由器

4. **多宿(Multi-homing)**
   - ISP连接到两个或更多提供商ISP
   - 目的：提高可靠性

5. **对等连接点(IXP)**
   - 多个ISP对等连接的汇合点
   - 通常是一个具有多台交换机的建筑物

### 内容分发网络(CDN)

现代互联网还广泛使用**内容分发网络(Content Delivery Network, CDN)**来提高性能。

> **CDN的工作原理**
> 
> CDN将内容(如网页、图片、视频)缓存在地理上分布的多个边缘服务器上，用户从最近的边缘服务器获取内容。

**CDN的优势**：
1. **减少延迟**：用户访问就近的服务器
2. **减少带宽成本**：减少原始服务器的负载
3. **提高可用性**：多个服务器提供冗余
4. **改善安全性**：分散流量，缓解DDoS攻击

**主要CDN提供商**：
- Akamai、Cloudflare、Amazon CloudFront
- 国内：阿里云CDN、腾讯云CDN、百度云CDN

**CDN部署策略**：
1. **Enter Deep**：深入接入ISP，靠近用户
2. **Bring Home**：在IXP和数据中心建立大集群

### 分组交换

#### 存储转发传输

> **存储转发传输(Store-and-Forward Transmission)**
> 
> 分组交换机必须接收到整个分组后才能开始向输出链路传输该分组的第一个比特。

**传输延迟计算**：

对于由N条速率均为R的链路组成的路径，传输L比特的分组：

$$端到端延迟 = N \times \frac{L}{R}$$

**例题1.1**：考虑通过3条链路发送一个分组，每条链路的传输速率为1.5 Mbps，分组长度为8000比特。计算端到端延迟。

**解析**：
- N = 3（3条链路）
- R = 1.5 Mbps = 1.5 × 10⁶ bps
- L = 8000比特

端到端延迟 = 3 × (8000 / 1.5 × 10⁶) = 3 × 0.0053 = 0.016秒 = 16毫秒

#### 排队延迟和分组丢失

**排队延迟**：当分组到达链路的速率超过链路的输出能力时，分组在输出缓存中排队等待。

**分组丢失**：当缓存空间完全被占满时，到达的分组将被丢弃。

#### 转发表和路由选择协议

**转发表(Forwarding Table)**：路由器将目的地址(或目的地址的一部分)映射成输出链路。

**路由选择算法**：确定分组从源到目的地所采取的路径，并以此设置转发表。

### 电路交换

> **电路交换(Circuit Switching)**
> 
> 在端系统间通信会话期间，预留端系统间沿路径通信所需要的资源(缓存、链路传输速率)。

**电路交换的三个阶段**：
1. **建立连接**：建立端到端的专用通信路径
2. **数据传输**：在专用路径上传输数据
3. **释放连接**：释放占用的资源

**复用方式**：

1. **频分复用(FDM)**
   - 频谱被划分为若干频段
   - 每个连接专用一个频段

2. **时分复用(TDM)**
   - 时间被划分为固定长度的帧
   - 每个连接在每帧中专用一个时隙

**例题1.2**：一条链路的传输速率为1 Mbps，使用TDM，每帧有10个时隙。每个连接的传输速率是多少？

**解析**：
每个连接的传输速率 = 总传输速率 / 时隙数 = 1 Mbps / 10 = 100 kbps

### 分组交换 vs 电路交换

| 比较项目 | 分组交换 | 电路交换 |
|----------|----------|----------|
| 资源利用 | 统计复用，效率高 | 专用资源，可能浪费 |
| 建立时间 | 无需建立连接 | 需要建立连接时间 |
| 服务质量 | 尽力而为，无法保证 | 固定带宽，质量稳定 |
| 适用场景 | 数据通信 | 语音通信 |
| 故障恢复 | 灵活，可选择备用路径 | 依赖专用路径 |

**分组交换优势**：
1. 提供比电路交换更好的带宽共享
2. 比电路交换更简单、更有效、实现成本更低

---

## 协议分层和服务模型

### 协议分层的必要性

> **分层的好处**
> 
> 1. **处理复杂系统**：显式结构允许识别复杂系统各部分之间的关系
> 2. **模块化**：易于维护和更新系统

### 协议栈

**互联网协议栈的5层**：

1. **应用层**：支撑网络应用程序
   - 协议：HTTP、SMTP、FTP
   - 数据单位：报文(Message)

2. **传输层**：进程-进程的数据传输
   - 协议：TCP、UDP
   - 数据单位：报文段(Segment)

3. **网络层**：路由数据报从源到目的地
   - 协议：IP、路由选择协议
   - 数据单位：数据报(Datagram)

4. **链路层**：相邻网络元素间的数据传输
   - 协议：Ethernet、WiFi、PPP
   - 数据单位：帧(Frame)

5. **物理层**：在线路上传输比特
   - 数据单位：比特(Bit)

### OSI参考模型

**ISO/OSI参考模型的7层**：

1. **应用层**
2. **表示层**：数据压缩、加密、格式转换
3. **会话层**：会话管理
4. **传输层**
5. **网络层**
6. **数据链路层**
7. **物理层**

### 封装过程

**数据封装**：每一层都在接收到的数据上增加首部信息。

```
应用层：    [Message]
传输层：    [TCP头|Message]
网络层：    [IP头|TCP头|Message]  
链路层：    [Eth头|IP头|TCP头|Message|Eth尾]
物理层：    转换为比特流传输
```

---

## 网络性能指标

### 延迟类型

**四种分组延迟**：

1. **节点处理延迟(Processing Delay)**
   - 检查分组首部和决定将分组导向何处所需要的时间
   - 典型值：微秒级别

2. **排队延迟(Queuing Delay)**
   - 分组在链路上等待传输的时间
   - 取决于路由器的拥塞程度

3. **传输延迟(Transmission Delay)**
   - 将分组的所有比特推向链路所需要的时间
   - 计算公式：$d_{trans} = \frac{L}{R}$
   - L：分组长度(比特)，R：链路传输速率(bps)

4. **传播延迟(Propagation Delay)**
   - 比特从链路起点传播到目的地所需时间
   - 计算公式：$d_{prop} = \frac{d}{s}$
   - d：物理链路长度(米)，s：传播速率(≈ 2×10⁸ m/s)

**总的节点延迟**：
$$d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$$

### 排队延迟和丢包

**流量强度**：
$$La/R$$
- L：分组长度(比特)
- a：分组到达队列的平均速率(分组/秒)
- R：传输速率(bps)

**排队延迟特征**：
- La/R ≈ 0：平均排队延迟很小
- La/R → 1：平均排队延迟变大
- La/R > 1：延迟趋向无穷大（系统不稳定）

**排队延迟的数学分析**：
对于M/M/1排队系统（泊松到达，指数服务时间，单服务器）：
- 平均排队延迟：$W_q = \frac{\rho}{1-\rho} \times \frac{1}{\mu}$
- 其中ρ = λ/μ（流量强度），λ为到达率，μ为服务率

### 端到端延迟

对于N台路由器的路径，总延迟：
$$d_{end-end} = N(d_{proc} + d_{trans} + d_{prop})$$

**例题1.3**：计算通过3台路由器发送1500字节分组的端到端延迟。每条链路传输速率为2 Mbps，长度为5000公里。处理延迟为3毫秒。

**解析**：
- L = 1500 × 8 = 12,000比特
- R = 2 × 10⁶ bps
- d = 5,000,000米
- s = 2 × 10⁸ m/s

传输延迟：$d_{trans} = \frac{12,000}{2 \times 10^6} = 0.006$秒 = 6毫秒

传播延迟：$d_{prop} = \frac{5,000,000}{2 \times 10^8} = 0.025$秒 = 25毫秒

总延迟：$d_{end-end} = 4 \times (3 + 6 + 25) = 136$毫秒

### 吞吐量

> **吞吐量(Throughput)**
> 
> 在源和目的地之间传输数据的速率(比特/时间单位)

**瞬时吞吐量**：给定时刻的传输速率
**平均吞吐量**：一段时间内的平均传输速率

**瓶颈链路**：限制端到端吞吐量的链路

对于$n$跳路径，各链路速率为$R_1, R_2, ..., R_n$：
$$吞吐量 = \min\{R_1, R_2, ..., R_n\}$$

---

## 网络安全概述

### 主要安全威胁

1. **恶意软件**
   - 病毒：需要用户交互才能感染
   - 蠕虫：无需用户交互即可感染

2. **拒绝服务攻击(DoS)**
   - 弱点攻击：利用应用程序或操作系统的漏洞
   - 带宽洪泛：向目标主机发送大量分组
   - 连接洪泛：建立大量的TCP连接

3. **分组嗅探**
   - 被动接收经过的分组副本
   - 记录每个分组的副本

4. **IP欺骗**
   - 生成具有虚假源地址的分组

### 基本防护措施

1. **防火墙**：过滤进出网络的分组
2. **入侵检测系统(IDS)**：检测可疑的网络活动
3. **加密**：保护数据的机密性
4. **认证**：验证通信实体的身份

---

## 计算机网络和因特网的历史

了解网络发展历史有助于理解现代网络技术的演进和设计思想。

### 分组交换的发展：1961-1972

**关键人物和事件**：

1. **1961年**：Leonard Kleinrock的博士论文首次提出分组交换理论
   - 证明了分组交换比电路交换更有效

2. **1962年**：J.C.R. Licklider提出"银河网络"概念
   - 设想全球联网的计算机

3. **1965年**：第一次广域网连接
   - MIT Lincoln实验室与System Development Corporation的计算机通过电话线连接

4. **1969年**：ARPANET诞生
   - 连接4个节点：UCLA、UCSB、SRI、犹他大学
   - 使用网络控制协议(NCP)

5. **1971年**：Ray Tomlinson发明网络电子邮件
   - 引入@符号用于地址标识

6. **1972年**：ARPANET公开演示
   - 连接15个节点，包括夏威夷的ALOHANET

### 网络互联：1972-1980

**TCP/IP协议的诞生**：

1. **1973年**：Vinton Cerf和Robert Kahn开始研究网络互联
   - 设计能够连接不同网络的协议

2. **1974年**：首次使用"Internet"术语
   - 在论文"A Protocol for Packet Network Intercommunication"中提出

3. **1978年**：TCP分离出IP
   - TCP/IP协议栈初具雏形

4. **1979年**：CSNET(Computer Science Network)提议
   - 为计算机科学研究提供网络服务

**其他重要发展**：
- **1976年**：以太网在Xerox PARC发明
- **1979年**：USENET创建，提供新闻组服务

### 网络的激增：1980-1990

**协议标准化**：

1. **1983年1月1日**：ARPANET正式采用TCP/IP
   - 标志着现代互联网的真正开始

2. **1984年**：域名系统(DNS)引入
   - 解决了主机名到IP地址的映射问题

3. **1986年**：NSFNET创建
   - 连接美国国家科学基金会的超算中心
   - 主干网速率：56 kbps

4. **1988年**：Internet蠕虫事件
   - Robert Morris Jr.编写的蠕虫感染6000台主机
   - 促进了网络安全意识的提高

**网络规模增长**：
- **1987年**：主机数量达到10,000台
- **1989年**：主机数量达到100,000台

### 因特网爆炸：1990年代

**万维网的诞生**：

1. **1989-1991年**：Tim Berners-Lee在CERN发明万维网
   - 创造了HTML、HTTP、URL、Web浏览器

2. **1993年**：Mosaic浏览器发布
   - Marc Andreessen在NCSA开发的图形化浏览器

3. **1994年**：Netscape公司成立
   - 商业化的Web浏览器

**商业化进程**：

1. **1991年**：NSFNET取消商业限制
   - 允许商业流量进入Internet

2. **1995年**：NSFNET退役
   - Internet完全商业化

3. **1995年**：域名注册开始收费
   - Network Solutions负责.com、.org、.net域名注册

**技术发展**：
- **1994年**：Yahoo!成立
- **1995年**：Amazon.com、eBay创立
- **1998年**：Google成立
- **1999年**：Napster推出，开启P2P时代

### 新千年的发展：2000年至今

**宽带普及**：
- **DSL和电缆调制解调器**普及
- **光纤到户(FTTH)**开始部署

**移动互联网**：
- **2007年**：iPhone发布，移动互联网爆发
- **4G/5G**：高速移动网络普及

**社交网络和云计算**：
- **2004年**：Facebook创立
- **2006年**：AWS(Amazon Web Services)推出
- **云计算**、**大数据**、**物联网**兴起

**新兴技术**：
- **软件定义网络(SDN)**
- **网络功能虚拟化(NFV)**
- **边缘计算**
- **6G研究**开始起步

---

## 典型例题

**例题1.4**：一个分组长度为10,000比特，链路传输速率为100 Mbps。如果要通过3台路由器(即4条链路)发送10个这样的分组，采用存储转发方式，总时间是多少？

**解析**：
- 分组长度：L = 10,000比特
- 传输速率：R = 100 × 10⁶ bps  
- 链路数：N = 4
- 分组数：P = 10

单个分组的传输延迟：$d_{trans} = \frac{10,000}{100 \times 10^6} = 0.1$毫秒

第一个分组的端到端延迟：$4 \times 0.1 = 0.4$毫秒

剩余9个分组只需要通过最后一条链路：$9 \times 0.1 = 0.9$毫秒

总时间：$0.4 + 0.9 = 1.3$毫秒

**例题1.5**：某链路的传输速率为1 Gbps，传播延迟为10毫秒。要使传播延迟等于传输1000字节分组的传输延迟，链路的长度应该是多少？

**解析**：
传输延迟 = 传播延迟
$\frac{L}{R} = \frac{d}{s}$

其中：
- L = 1000 × 8 = 8,000比特
- R = 1 × 10⁹ bps
- s = 2 × 10⁸ m/s

$\frac{8,000}{1 \times 10^9} = \frac{d}{2 \times 10^8}$

$d = \frac{8,000 \times 2 \times 10^8}{1 \times 10^9} = 1,600$米

---

## 本章小结

### 核心概念回顾

1. **互联网本质**：
   - 全球性的计算机网络，连接数十亿设备
   - 既是硬件和软件的集合，也是为应用提供服务的基础设施
   - 协议定义了通信的规则和格式

2. **网络结构**：
   - **网络边缘**：端系统通过接入网连接到互联网
   - **网络核心**：ISP层次结构，分组交换机和链路构成网状网络
   - **现代技术**：CDN提高性能，边缘计算降低延迟

3. **分组交换原理**：
   - 存储转发机制：必须完整接收分组才能转发
   - 与电路交换相比：统计复用提高效率，但无QoS保证
   - 路由和转发：通过路由算法构建转发表

4. **网络性能**：
   - **延迟组成**：处理+排队+传输+传播延迟
   - **关键因子**：流量强度La/R决定排队延迟
   - **吞吐量**：端到端性能受瓶颈链路限制

5. **协议分层**：
   - **5层模型**：应用层→传输层→网络层→链路层→物理层
   - **封装过程**：每层添加头部信息
   - **服务模型**：上层使用下层服务

6. **发展历程**：
   - 从ARPANET到现代互联网的演进
   - 关键技术：分组交换、TCP/IP、万维网
   - 标准化进程：IETF和RFC文档系统

### 重要公式总结

| 概念 | 公式 | 说明 |
|------|------|------|
| 传输延迟 | $d_{trans} = L/R$ | L:分组长度，R:传输速率 |
| 传播延迟 | $d_{prop} = d/s$ | d:距离，s:传播速度 |
| 端到端延迟 | $d_{end-end} = N \times (d_{proc} + d_{trans} + d_{prop})$ | N:路由器数量 |
| 流量强度 | $La/R$ | L:分组长度，a:到达速率，R:传输速率 |

### 学习要点

1. **概念理解**：重点理解分组交换的工作原理
2. **计算能力**：熟练掌握延迟和吞吐量的计算
3. **比较分析**：能够比较不同技术方案的优缺点
4. **系统思维**：理解网络作为一个复杂系统的特点

### 从网络基础到应用实践

通过本章学习，我们建立了对计算机网络的整体认知。我们了解了：
- 互联网的物理组成和逻辑结构
- 数据如何通过分组交换在网络中传输
- 协议分层如何简化复杂的网络通信
- 网络性能的影响因素和计算方法

### 下一章预告：深入应用层

下一章我们将采用**自顶向下**的方法，从您最熟悉的网络应用开始：

1. **网络应用体系结构**：
   - 客户-服务器模式 vs P2P模式
   - 应用层协议的设计原则

2. **万维网和HTTP**：
   - 从浏览器输入URL到页面显示的完整过程
   - HTTP协议的工作机制和演进

3. **电子邮件系统**：
   - SMTP、POP3、IMAP协议
   - 现代邮件系统的架构

4. **DNS域名系统**：
   - 互联网的"电话簿"如何工作
   - 域名解析的完整过程

5. **套接字编程**：
   - 如何编写网络应用程序
   - TCP和UDP编程实例

这种自顶向下的学习方法将帮助您：
- 从熟悉的应用入手理解网络原理
- 建立应用需求到底层实现的联系
- 为深入学习传输层和网络层打下基础

**[开始第2章：应用层](第2章：应用层.md)**
