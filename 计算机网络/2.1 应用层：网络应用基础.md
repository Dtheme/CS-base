# 2.1 应用层：网络应用基础.md

## 目录

1. [学习目标](#学习目标)
2. [重要性概览](#重要性概览)
3. [网络应用程序体系结构](#网络应用程序体系结构)
4. [进程通信](#进程通信)
5. [传输层服务需求](#传输层服务需求)
6. [因特网传输服务](#因特网传输服务)
7. [应用层协议](#应用层协议)

---

## 网络应用程序体系结构

### 应用程序体系结构概述

网络应用程序由运行在不同端系统上的程序组成，这些程序通过网络相互通信。

> **网络应用程序的核心**
> 
> 网络应用程序的核心是编写能够运行在不同端系统上并通过网络彼此通信的程序。

**重要原则**：我们无需为网络核心设备（如路由器、交换机）编写软件，因为：
- 网络核心设备不运行用户应用程序
- 端系统上的软件实现足以构建完整的网络应用
- 这种设计促进了网络应用的快速开发和部署

### 网络应用体系结构

现代网络应用主要采用三种体系结构：

#### 客户-服务器体系结构

> **客户-服务器(Client-Server)体系结构**
> 
> 有一个总是打开的主机称为服务器，它服务于许多来自其他称为客户的主机的请求。

**服务器特征**：
- **总是打开**：7×24小时运行
- **永久的IP地址**：便于客户定位
- **服务器群集**：处理大量客户请求
- **数据中心**：扩展服务能力

**客户特征**：
- **间歇性连接**：需要时才连接服务器
- **动态IP地址**：可能每次连接都不同
- **不直接通信**：客户之间通常不直接通信

**典型应用**：Web、FTP、Telnet、电子邮件

**优势**：
- 集中管理和控制
- 数据一致性好
- 安全性相对容易保证
- 便于备份和恢复

**劣势**：
- 服务器可能成为性能瓶颈
- 单点故障风险
- 扩展成本高

#### P2P体系结构

> **P2P(Peer-to-Peer)体系结构**
> 
> 对总是打开的基础设施服务器有最小的（或者没有）依赖。应用程序在间断连接的主机对之间使用直接通信。

**P2P特征**：
- **自扩展性**：新对等方既带来服务请求，也带来服务能力
- **成本有效**：不需要庞大的服务器基础设施
- **分散化**：没有集中控制点
- **动态性**：对等方间歇性连接并改变IP地址

**P2P优势**：
- 扩展性好：用户越多，总服务能力越强
- 成本低：无需大型服务器群
- 容错性强：没有单点故障

**P2P挑战**：
- 安全性：难以认证和授权
- 性能：依赖于对等方的可用性和性能
- 可靠性：缺乏集中管理
- 管理复杂：版本控制、更新困难

**典型应用**：BitTorrent、Skype（部分P2P）、区块链

#### 混合体系结构

结合客户-服务器和P2P的优点：

**即时通信应用**：
- 聊天在两个用户之间是P2P的
- 中心化服务器用于定位用户

**文件共享应用**：
- 中心化服务器用于内容索引
- P2P方式进行实际文件传输

**现代云服务**：
- 边缘计算：在用户附近提供计算服务
- CDN：内容分发采用分布式架构
- 微服务：内部服务间通信

---

## 进程通信

### 进程概念

> **进程(Process)**
> 
> 进程是在端系统中运行的程序。

**同一端系统上的进程通信**：
- 操作系统提供进程间通信机制
- 共享内存、管道、信号量、消息队列等
- 通过内核进行协调

**不同端系统上的进程通信**：
- 通过在计算机网络间交换报文通信
- 需要网络协议的支持
- 通过套接字接口实现

### 客户和服务器进程

> **客户和服务器进程的定义**
> 
> - **客户进程**：发起通信的进程
> - **服务器进程**：等待联系的进程

**重要说明**：
- 在P2P应用中，一个进程既可以是客户也可以是服务器
- 在给定的一对进程之间的通信会话中，发起会话的进程被标识为客户
- 等待联系以开始会话的进程是服务器

### 进程与计算机网络之间的接口

进程通过**套接字(Socket)**向网络发送报文和从网络接收报文。

> **套接字**
> 
> 套接字是同一台主机内应用层与传输层之间的接口。它是应用程序与网络间的API（应用程序编程接口）。

**套接字的比喻**：
- 进程类似房子
- 套接字类似房门
- 通信过程类似从一个房子的门到另一个房子的门
- 发送进程将报文推出门外
- 接收进程从门外获取报文

**套接字地址**：
为了标识接收进程，需要两种信息：
1. **主机的地址**：IP地址（32位标识符）
2. **主机中接收进程的标识符**：端口号

**常用端口号**：
- HTTP：80
- HTTPS：443
- FTP：21
- SMTP：25
- DNS：53
- POP3：110
- IMAP：143

---

## 传输层服务需求

应用程序需要传输层协议提供的服务可以归结为四个方面：

### 可靠数据传输

> **可靠数据传输**
> 
> 协议提供确保由应用程序的一端发送的数据正确、完全地交付给另一端的服务。

**对可靠性的不同需求**：

**可靠性关键应用**：
- 银行交易、电子商务
- 文件传输、电子邮件
- Web浏览
- 数据库应用

**容忍丢失的应用**：
- 实时音频/视频应用
- 在线游戏
- 传感器数据收集
- 这类应用被称为**损耗容忍应用**

### 吞吐量

> **吞吐量要求**
> 
> - **带宽敏感应用**：需要特定的吞吐量保证
> - **弹性应用**：能够根据可用吞吐量调整工作

**带宽敏感应用**：
- 多媒体应用：视频流需要恒定速率
- 语音应用：电话需要32kbps的吞吐量
- 视频会议：需要数Mbps的带宽

**弹性应用**：
- 电子邮件：发送时间不敏感
- 文件传输：传输速度可以变化
- Web浏览：页面加载可以等待

### 定时

> **定时要求**
> 
> 传输层协议提供定时保证，如每个比特的延迟不超过某个阈值。

**对定时敏感的应用**：
- 交互式实时应用：
  - 在线游戏
  - 语音通话
  - 视频会议
  - 远程桌面

**定时要求指标**：
- **延迟**：数据从发送到接收的时间
- **抖动**：延迟的变化
- **实时要求**：通常需要延迟<150ms

### 安全性

> **安全性要求**
> 
> 传输层协议能够为应用程序提供加密、数据完整性和端点鉴别服务。

**安全服务内容**：
- **机密性**：防止数据被窃听
- **数据完整性**：防止数据被篡改
- **端点鉴别**：确认通信对方身份
- **访问控制**：控制资源访问权限

---

## 因特网传输服务

因特网为应用程序提供两个传输层协议：

### TCP服务

> **TCP(Transmission Control Protocol)服务**

**面向连接的服务**：
- 客户和服务器进程开始发送数据前进行握手
- 握手过程建立TCP连接
- 连接是全双工的：双方可同时发送数据
- 通信完成后拆除连接

**可靠数据传输服务**：
- 保证无差错、按序交付数据
- 接收方确认接收到的数据
- 发送方重传未确认的数据
- 检测和纠正传输错误

**流量控制**：
- 发送方不会淹没接收方
- 接收方控制发送方的发送速率
- 滑动窗口机制

**拥塞控制**：
- 当网络拥塞时限制发送方发送速率
- 为整个网络服务而非特定应用
- 防止网络崩溃

**安全性增强**：
- TCP本身不提供加密
- TLS(SSL)可以提供安全的TCP连接
- HTTPS = HTTP over TLS over TCP

### UDP服务

> **UDP(User Datagram Protocol)服务**

**无连接服务**：
- 没有握手过程
- 两个进程通信前没有建立连接
- 发送方直接发送数据

**不可靠数据传输服务**：
- 不保证报文到达
- 不保证按序到达
- 没有流量控制和拥塞控制
- 可能出现重复、丢失、乱序

**轻量级特性**：
- 协议开销小
- 传输速度快
- 实时性好

**适用场景**：
- 实时应用：语音、视频
- 简单请求-响应：DNS查询
- 广播和多播应用
- 对可靠性要求不高的应用

### TCP vs UDP对比

| 特性 | TCP | UDP |
|------|-----|-----|
| 连接性 | 面向连接 | 无连接 |
| 可靠性 | 可靠传输 | 不可靠传输 |
| 流量控制 | 有 | 无 |
| 拥塞控制 | 有 | 无 |
| 头部开销 | 20字节 | 8字节 |
| 速度 | 相对慢 | 快 |
| 适用场景 | 可靠性要求高 | 实时性要求高 |

---

## 应用层协议

> **应用层协议**
> 
> 应用层协议定义了运行在不同端系统上的应用程序进程如何相互传递报文。

### 应用层协议的定义内容

**应用层协议定义**：
1. **交换的报文类型**：请求报文、响应报文
2. **各种报文类型的语法**：报文中各字段及其描述方法
3. **字段的语义**：字段中信息的含义
4. **进程何时以及如何发送报文和响应报文的规则**

### 协议与网络应用的区别

> **重要区别**
> 
> 网络应用包括应用层协议，但不仅仅是协议。应用还包括用户界面、数据格式、数据库等。

**例子**：Web应用
- **协议**：HTTP协议定义报文格式和交换规则
- **应用**：还包括Web浏览器、Web服务器软件、HTML标准、CSS、JavaScript等

### 协议分类

**公共域协议**：
- 由RFC文档定义
- 开放标准，任何人都可以实现
- 例如：HTTP、SMTP、FTP、DNS

**专有协议**：
- 由特定组织开发和控制
- 可能不公开协议细节
- 例如：Skype、微信、QQ等他们可能有一些自有协议

---
 
**[下一节：2.2 万维网和HTTP技术](2.2应用层：万维网和HTTP技术.md)**
